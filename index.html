<!DOCTYPE html>
<html>
<head>
	<title>KALAUJADIBUKU</title>

	<meta property="og:url" content="http://robotys.net/kalaujadibuku" /> 
	<meta property="og:title" content="KALAU FB JADI BUKU" />
	<meta property="og:description" content="Klik untuk lihat berapa banyak buku yang boleh dihasilkan daripada semua status fb anda &raquo;" id="share_description"/> 
	<meta property="og:image" content="http://robotys.net/kalaujadibuku/screenshot.png" /> 

	<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
	<script>
		var stop_feeding = false;
		var total_status = 0;
		var total_words = 0;
		var total_books = 0;
		var per_book = 25000; // 25000 words per book
		var last_next = '';
		var last_response;
		// load fb sdk
		window.fbAsyncInit = function() {
			
			// live: 1567024923535252
			// test: 1567165170187894

			FB.init({
				appId      : '1567024923535252',
				xfbml      : false,
				version    : 'v2.1',
				status	   : true
			});

			// run code here
			$(document).ready(function(){
				
				$('.akses_fb').on('click', function(){
					FB.login(function(){
						
						// get_feed();
						$('.start_feed, #feed_switch, .share_fb').prop('disabled', false);
					
					}, {scope: 'read_stream'});
				});

				$('.start_feed').on('click', function(){
					get_feed();
				});

				$('#feed_switch').on('click', function(){
					$('.status > i').html('');
					stop_feeding = true;
				});

				$('.share_fb').on('click', function(){
					var string = 'Saya boleh hasilkan '+total_books+' daripada kesemua '+total_status+' status FB saya! '+'Klik untuk lihat berapa banyak buku yang boleh dihasilkan daripada semua status fb anda pula &raquo;';

					// console.log(string);
					$('#share_description').attr('content', string);	
					// console.log($('#share_description').attr('content'));

					FB.ui({
					  method: 'share',
					  href: 'http://robotys.net/kalaujadibuku',
					}, function(response){});
				});

			});
		};

		(function(d, s, id){
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) {return;}
			js = d.createElement(s); js.id = id;
			js.src = "//connect.facebook.net/en_US/sdk.js";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));


		function get_feed(next){

			$('.status > i').html('<img src="loading.gif"/> <br/>');

			// console.log(stop_feeding);
			if(stop_feeding == false){
				if(next == undefined) next = '/me/feed?limit=1000&fields=message&from=me()';
				FB.api(
				    next,
				    function (response) {
				      if (response && !response.error) {
				        /* handle the result */
				        if(response.paging != undefined){
				        	// console.log('fetch '+response.data.length,'paging: ',response.paging.next);	
				        	// console.log(response);
					        total_status = total_status+response.data.length;

					        $.each(response.data, function(index, obj){
					        	if(obj.message != undefined){
					        		total_words = total_words+obj.message.split(' ').length;
					        	}
					        });

					        total_books = (total_words/per_book).toFixed(2);
					        var status = 'total fetched: '+total_status+'. Next batch ...';
					        // console.log('bytes: '+ $('.feeds').html().length);
					        $('.total_status').html(total_status);
					        $('.total_words').html(total_words);
					        $('.total_book').html(total_books);

					        var title = '('+total_status+') WALLFETCH';
					        $('title').html(title);
					        show_feed(response);
					        get_feed(response.paging.next);
					        last_next = next;
					        last_response = response;
				        } 
				        else{
							// kalau rosak, run manually!
				        	console.log('Last: '+last_next, last_response);
				        	console.log('Now: '+next, response);
				        	// console.log('bytes: '+ $('.feeds').html().length);

				        	$.get(last_next, function(resp){
				        		console.log(resp);
				        		// show_feed(resp);
					        	// get_feed(resp.paging.next);
				        	});
				        	// get_feed(last_next);

				        	// $('.status').html('Done! Total fetched: '+total_status);
				        	// $('.feed_switch').hide();
				        } 

				      }
				    }
				);
			}
		}

		function show_feed(response){
			$.each(response.data, function(index,object){
				if(object.message !== undefined){
					var feed = ''+(object.message)+'\n\n___________________________________\n\n\n';
					$('.feeds').append(feed);
				}
			});
		}

		
    </script>

    <style>
    	body{
    		font-family: sans-serif;
    		font-size: 16px;
    		color: #444;
    		text-align: center;
    	}

    	.center{
    		width: 500px;
    		margin: 0 auto;
    	}

    	.wrap{
    		width: 500px;
    		float: left;
    	}

    	.status{
    		background: #ccc;
    		padding: 8px;
    		width: 100%;
    		box-sizing: border-box;
    	}

    	.status span{
    		font-weight: bold;
    		font-size: 1.5em;
    	}

    	ol, li{
    		text-align: left;
    	}
    </style>

</head>
<body>

<div class="center"><div class="wrap">
	
	<img src="1024x1024.jpg" style="width: 60px; height: auto; border-radius: 50%; margin-top:50px">
	<h1>KALAUJADIBUKU</h1>
	<p>Pasti pernah terfikir, berapa buah bukukah yang akan terhasil kalau semua status FB kita dijadikan buku? Jangan tertanya-tanya lagi! Klik Butang berikut mengikut turutan:</p>

	<p><button class="akses_fb">1) Akses FB &raquo;</button> &nbsp; <button class="start_feed" disabled="disabled">2) Mula Kira &raquo;</button> &nbsp; <button id="feed_switch" disabled="disabled">(Jika Perlu) Berhenti &raquo;</button> &nbsp; <button class="share_fb" disabled='disabled'>Share di FB &raquo;</button></p>

	<p class="status">
		<i></i>
		Jumlah Status: <span class="total_status">000</span> 
						<br/> Jumlah Perkataan: <span class="total_words">00000000</span>
						<br/> Jumlah Buku: <span class="total_book">00</span></p>

	<textarea class="feeds" style="width: 480px; height: 300px;"></textarea>

	<h1>Dari Status FB Menjadi Buku</h1>
	<p>Alangkah ruginya status kita jika ia tidak dirancang. Ia habis begitu sahaja. Ia hilang dihakis masa.</p>
	<p>Seminar "Dari Status FB Menjadi Buku" akan berkongsi tentang cara menyusun status, menulis di FB dan merancang kejayaan penerbitan buku daripada status-status FB kita. Klik link <a href="#">Dari Status FB Menjadi Buku</a> untuk keterangan lanjut</p>
</div></div>

</body>
</html>